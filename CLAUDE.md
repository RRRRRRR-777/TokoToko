# AGENT.md

AIエージェント（ChatGPT / Claude / Code Agents / Codex）向けガイドライン

## Codex 連携ガイド

### 目的

ユーザーが 「Codexと相談しながら進めて」 （または類似表現）と指示した場合、
Claude Code は Codex を随時呼び出しながら、複数ターンにわたる協業を行う。

### トリガー
• 正規表現: /Claude.*相談しながら/
• 一度トリガーした後は、ユーザーが明示的に終了を指示するまで 協業モード を維持する。

### 協業ワークフロー (ループ可)

1 PROMPT 準備 最新のユーザー要件 + これまでの議論要約を
$PROMPT に格納
2 Codex 呼び出し`codex << "$PROMPT"`
  - 必要に応じ --max_tokens 等を追加
3 出力貼り付け  Codex ➜ セクションに全文、長い場合は要約＋原文リンク
4 Codex コメント  Codex ➜ セクションで Codex の提案を分析・統合し、次アクションを提示
5 継続判定  ユーザー入力 or プラン継続で 1〜4 を繰り返す。「Codexコラボ終了」「ひとまずOK」等で通常モード復帰

形式テンプレート

**Codex ➜**
<Codex からの応答>
**ClaudeCode ➜**
<統合コメント & 次アクション>

### Codex の使い方
- ターミナルで以下を実行すると Codex と対話できる。
```bash
codex exec "<質問・依頼内容>"
```

## タスクの進め方
- タスクは基本的にvibe-kanban MCPを参照する
1. vibe-kanban MCPからタスクを確認
1. ユーザーに実行するタスクを提案する
  - 概要、目的、完了条件を伝える
1. ユーザーから許可された後にタスクを進める
  - ステータスを「In Progress」にする
1. ユーザーにタスクをレビューしてもらう
  - ステータスを「In Review」にする
  - 変更差分を伝える、実行できるものは検証を要求する
1. ユーザーからレビュー完了と伝えられたらタスクを完了し、次のタスクを提案する
  - ステータスを「Done」にする
  - 変更差分をコミットする

## 1. 目的

AIエージェントがプロジェクトに参加する際の **役割・ルール・制約・出力基準** を明確にし、作業品質の均一化と仕掛かり管理を円滑にする。

---

## 2. エージェントの役割

* 要件の整理、仕様作成の補助
* アーキテクチャ・設計・方針案の生成
* コード作成・リファクタリング
* テストコード生成
* ドキュメント整備
* 問題調査（エラー原因特定、デバッグ方針の提示）
* タスク分解、ワークフロー提案

---

## 3. 出力ルール

### 3.1 基本

* **結論 → 理由 → 具体例 → 追加提案** の順で回答する
* 不明点は推測せず **必ず質問して補完**
* コードは **動作可能な最小単位** で提示
* 専門用語は簡潔に説明する

### 3.2 コード生成

* Lint/Formatter（プロジェクト規約）に準拠
* コメントは必要最小限で簡潔に
* 設計変更を伴う提案は理由を明記する
* 既存のコードパターンやプロジェクトの慣習に従う

### 3.3 仕様確認のプロセス（Water-Scrum-Fast モデル準拠）

AI駆動開発では「曖昧な仕様に敏感」であるため、以下のプロセスを遵守する：

* タスク着手前に **スコープと成功指標** を明確にする
* 不明点は実装前に質問し、固定点を設定する
* アーキテクチャに影響する変更は必ず事前提案する
* 仕様が不明瞭な場合は、最低限の固定点を人間と合意してから実装に入る

---

## 4. 禁止事項

### 4.1 一般的な禁止事項

* 推測による設定値・仕様値の決め打ち
* フレームワークやライブラリのバージョン無視
* 「たぶん動きます」などの不確実な記述
* 外部に存在しない API/関数の創作

### 4.2 セキュリティ禁止事項（Rails 特有）

* SQL インジェクションのリスクがある生SQLの使用（生のクエリ文字列の連結など）
* XSS 脆弱性につながる HTML の直接レンダリング（`html_safe` の不適切な使用）
* CSRF トークンの無効化
* Strong Parameters の回避（パラメータの無防備な許可）
* 機密情報（パスワード、APIキー、トークンなど）のハードコーディング
* Mass Assignment の脆弱性を生むコード
* 認証・認可のバイパス

---

## 5. 品質ゲート

エージェントが生成する成果物は以下に基づいてチェックされる。

### 5.1 コード品質

* 再現可能な実装になっているか
* 入出力が明確か
* エラー処理が適切か
* 副作用が明示されているか
* 無駄な抽象化・過度な最適化をしない
* Rubocop の指摘に準拠しているか
* RSpec でのテストカバレッジを考慮しているか

### 5.2 仕様・文章

* 曖昧語（「適宜」「大体」など）を使わない
* 「誰が・何を・いつ・どこで・どうやって」が明確
* 必要なら例・ユースケースを提示

---

## 6. 仕掛かり（WIP）管理

エージェントは作業開始時に TodoWrite ツールを使用し、以下を明記する：

* 現在理解しているタスク内容
* タスクの前提条件
* 不明点 / 確認事項
* 依存関係
* 次に行うアクション（具体的なファイル名・メソッド名を含む）
* 完了条件（Definition of Done）

各タスクは `in_progress` → `completed` と進捗を更新する。

---

## 7. タスク依頼テンプレート（人間→AIエージェント）

```
# Task
やりたいことを記載

# Context
関連ファイル / システム構成 / 制約

# Requirements
必須事項・制約・最終的な形

# Done
完了条件

# Notes
補足・前提など
```

---

## 8. タスク回答テンプレート（AIエージェント→人間）

```
# Summary
回答の要点

# Detail
理由・背景・解説

# Output
コード / 設計案 / 表など

# Checks
依存関係・前提・リスク・代替案

# Next Action
次に実施すべき行動
```

---

## 9. プロジェクト固有情報

### 9.1 プロジェクト概要


### 9.2 技術スタック

#### コアフレームワーク


#### 認証・認可

#### フロントエンド

#### バックグラウンドジョブ

#### テスト・品質管理

#### 主要な外部連携

#### カスタムGem（`vendor/gems/`）

### 9.3 プロジェクト構造

### 9.4 開発フロー

#### ブランチ戦略

#### チケット管理

### 9.5 必須チェック項目

#### コード品質

#### 既存パターンの踏襲

#### コミット・PR

#### セキュリティ

### 9.6 よく使うコマンド

### 9.7 参照すべきメモリ

### 9.8 コーディング規約

---

## 10. 補足

このガイドラインは AI駆動開発の効率化と品質担保を目的としている。
不明点があれば遠慮なく質問し、常に **スコープの明確化** を意識すること。
