# TekuToko API ServiceAccount
# Workload Identityを使用してGCPサービスにアクセス
apiVersion: v1
kind: ServiceAccount
metadata:
  name: tekutoko-api-sa
  labels:
    app: tekutoko-api
  annotations:
    # Workload Identity: KubernetesのSAとGCPのSAを紐付け
    iam.gke.io/gcp-service-account: tekutoko-api@tokotoko-ea308.iam.gserviceaccount.com

# GCP側で必要な設定:
#
# 1. GCPサービスアカウント作成:
#    gcloud iam service-accounts create tekutoko-api \
#      --display-name="TekuToko API Service Account"
#
# 2. 必要なロールを付与:
#    gcloud projects add-iam-policy-binding PROJECT_ID \
#      --member="serviceAccount:tekutoko-api@PROJECT_ID.iam.gserviceaccount.com" \
#      --role="roles/cloudsql.client"
#
#    gcloud projects add-iam-policy-binding PROJECT_ID \
#      --member="serviceAccount:tekutoko-api@PROJECT_ID.iam.gserviceaccount.com" \
#      --role="roles/secretmanager.secretAccessor"
#
# 3. Workload Identityバインディング:
#    gcloud iam service-accounts add-iam-policy-binding \
#      tekutoko-api@PROJECT_ID.iam.gserviceaccount.com \
#      --role roles/iam.workloadIdentityUser \
#      --member "serviceAccount:PROJECT_ID.svc.id.goog[default/tekutoko-api-sa]"
#
# 必要な権限:
# - roles/cloudsql.client: Cloud SQL Proxy経由でDB接続
# - roles/secretmanager.secretAccessor: Secret Managerから認証情報取得
# - roles/storage.objectViewer: Firebase Storage読み取り（必要に応じて）
# - roles/firebase.admin: Firebase Admin SDK使用（必要に応じて）
